<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redisç¬”è®° | é¡»è´º</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?9146a86d484b79eb7a9fab54d0655aa0";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
        </script>
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/MouseClickEffect.js"></script>
    <meta name="description" content="ã€Šé¸Ÿæ¬²é«˜é£å…ˆå±•ç¿…ï¼Œäººæ±‚ä¸Šè¿›å…ˆè¯»ä¹¦ã€‹">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.c55ec633.css" as="style"><link rel="preload" href="/assets/js/app.7036e47e.js" as="script"><link rel="preload" href="/assets/js/4.ec8df83f.js" as="script"><link rel="preload" href="/assets/js/1.d2920358.js" as="script"><link rel="preload" href="/assets/js/2.245be42e.js" as="script"><link rel="preload" href="/assets/js/56.248288b0.js" as="script"><link rel="preload" href="/assets/js/12.44af248e.js" as="script"><link rel="prefetch" href="/assets/js/10.a2ab4732.js"><link rel="prefetch" href="/assets/js/11.cb2a446e.js"><link rel="prefetch" href="/assets/js/13.fe5d2510.js"><link rel="prefetch" href="/assets/js/14.a86b66a0.js"><link rel="prefetch" href="/assets/js/15.db93f4b6.js"><link rel="prefetch" href="/assets/js/16.315be0a7.js"><link rel="prefetch" href="/assets/js/17.bb33c2d3.js"><link rel="prefetch" href="/assets/js/18.aa3bc2d5.js"><link rel="prefetch" href="/assets/js/19.eb6674e0.js"><link rel="prefetch" href="/assets/js/20.26398a86.js"><link rel="prefetch" href="/assets/js/21.8573d310.js"><link rel="prefetch" href="/assets/js/22.f39eb1c6.js"><link rel="prefetch" href="/assets/js/23.70b63e87.js"><link rel="prefetch" href="/assets/js/24.780f4265.js"><link rel="prefetch" href="/assets/js/25.087b890e.js"><link rel="prefetch" href="/assets/js/26.a3432377.js"><link rel="prefetch" href="/assets/js/27.c82078d0.js"><link rel="prefetch" href="/assets/js/28.3f62dff1.js"><link rel="prefetch" href="/assets/js/29.c935e9bc.js"><link rel="prefetch" href="/assets/js/30.4acfb7de.js"><link rel="prefetch" href="/assets/js/31.3bd52897.js"><link rel="prefetch" href="/assets/js/32.cd6a4df7.js"><link rel="prefetch" href="/assets/js/33.4f206021.js"><link rel="prefetch" href="/assets/js/34.ad299da7.js"><link rel="prefetch" href="/assets/js/35.a74cd3c6.js"><link rel="prefetch" href="/assets/js/36.a6d81e30.js"><link rel="prefetch" href="/assets/js/37.e3323ce2.js"><link rel="prefetch" href="/assets/js/38.18d7dd67.js"><link rel="prefetch" href="/assets/js/39.833f42ab.js"><link rel="prefetch" href="/assets/js/40.ed6400f3.js"><link rel="prefetch" href="/assets/js/41.81e6fc53.js"><link rel="prefetch" href="/assets/js/42.d0e39d51.js"><link rel="prefetch" href="/assets/js/43.047ac597.js"><link rel="prefetch" href="/assets/js/44.6e407d3e.js"><link rel="prefetch" href="/assets/js/45.234ad067.js"><link rel="prefetch" href="/assets/js/46.3eaaa14c.js"><link rel="prefetch" href="/assets/js/47.cd7ab522.js"><link rel="prefetch" href="/assets/js/48.d146214c.js"><link rel="prefetch" href="/assets/js/49.5412d8fd.js"><link rel="prefetch" href="/assets/js/5.83420c85.js"><link rel="prefetch" href="/assets/js/50.361271e2.js"><link rel="prefetch" href="/assets/js/51.2488c147.js"><link rel="prefetch" href="/assets/js/52.a5eb5e9f.js"><link rel="prefetch" href="/assets/js/53.c3859002.js"><link rel="prefetch" href="/assets/js/54.c572a44d.js"><link rel="prefetch" href="/assets/js/55.30248800.js"><link rel="prefetch" href="/assets/js/57.3a11d1c7.js"><link rel="prefetch" href="/assets/js/58.95fa43c5.js"><link rel="prefetch" href="/assets/js/59.d002a857.js"><link rel="prefetch" href="/assets/js/6.5faf5a50.js"><link rel="prefetch" href="/assets/js/60.26b4ef39.js"><link rel="prefetch" href="/assets/js/61.7c152e5e.js"><link rel="prefetch" href="/assets/js/62.baeb52bb.js"><link rel="prefetch" href="/assets/js/63.8978958b.js"><link rel="prefetch" href="/assets/js/64.b14585b3.js"><link rel="prefetch" href="/assets/js/7.13c62f03.js"><link rel="prefetch" href="/assets/js/8.b2b362e0.js"><link rel="prefetch" href="/assets/js/9.0fd0389d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c55ec633.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-faf1ae92><div data-v-faf1ae92><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-faf1ae92 data-v-faf1ae92><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-5cb9a64e data-v-faf1ae92 data-v-faf1ae92><h3 class="title" style="display:none;" data-v-5cb9a64e data-v-5cb9a64e>é¡»è´º</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-5cb9a64e data-v-5cb9a64e><input type="password" value="" data-v-5cb9a64e> <span data-v-5cb9a64e>Konck! Knock!</span> <button data-v-5cb9a64e>OK</button></label> <div class="footer" style="display:none;" data-v-5cb9a64e data-v-5cb9a64e><span data-v-5cb9a64e><i class="iconfont reco-theme" data-v-5cb9a64e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-5cb9a64e>vuePress-theme-reco</a></span> <span data-v-5cb9a64e><i class="iconfont reco-copyright" data-v-5cb9a64e></i> <a data-v-5cb9a64e><span data-v-5cb9a64e>ğŸˆ</span>
          Â Â 
          <span data-v-5cb9a64e>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-faf1ae92><div data-v-faf1ae92><div id="smart" class="wrapper-page" style="background-image:url(/img/bjt3.jpg);background-position-x:center;background-position-y:center;background-size:cover;background-repeat-x:no-repeat;background-repeat-y:no-repeat;" data-v-faf1ae92><header class="navbar" data-v-faf1ae92><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="é¡»è´º" class="logo"> <span class="site-name">é¡»è´º</span></a> <div class="links"><div id="dayNightSwitch" class="generalWrapper" data-v-32f44868><a class="click" data-v-32f44868><div class="onOff daySwitch" data-v-32f44868><div class="star star1" data-v-32f44868></div> <div class="star star2" data-v-32f44868></div> <div class="star star3" data-v-32f44868></div> <div class="star star4" data-v-32f44868></div> <div class="star star5" data-v-32f44868></div> <div class="star sky" data-v-32f44868></div> <div class="sunMoon" data-v-32f44868><div class="crater crater1" data-v-32f44868></div> <div class="crater crater2" data-v-32f44868></div> <div class="crater crater3" data-v-32f44868></div> <div class="cloud part1" data-v-32f44868></div> <div class="cloud part2" data-v-32f44868></div></div></div></a></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/å…¶ä»–/" class="nav-link"><i class="iconfont undefined"></i>
  å…¶ä»–
</a></li><li class="dropdown-item"><!----> <a href="/categories/æ”¶è—/" class="nav-link"><i class="iconfont undefined"></i>
  æ”¶è—
</a></li><li class="dropdown-item"><!----> <a href="/categories/å‰ç«¯/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯
</a></li><li class="dropdown-item"><!----> <a href="/categories/å®‰è£…/" class="nav-link"><i class="iconfont undefined"></i>
  å®‰è£…
</a></li><li class="dropdown-item"><!----> <a href="/categories/ç¬”è®°/" class="nav-link"><i class="iconfont undefined"></i>
  ç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/categories/è¸©å‘/" class="nav-link"><i class="iconfont undefined"></i>
  è¸©å‘
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´è½´
</a></div><div class="nav-item"><a href="/view/reward/" class="nav-link"><i class="iconfont undefined"></i>
  å¥–åŠ±
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  å…³äº
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-faf1ae92></div> <aside class="sidebar" data-v-faf1ae92><div class="personal-info-wrapper" data-v-03833281 data-v-faf1ae92><img src="/img/author.png" alt="author-avatar" class="personal-img" data-v-03833281> <h3 class="name" data-v-03833281>
    ğŸˆ
  </h3> <div class="num" data-v-03833281><div data-v-03833281><h3 data-v-03833281>43</h3> <h6 data-v-03833281>æ–‡ç« </h6></div> <div data-v-03833281><h3 data-v-03833281>32</h3> <h6 data-v-03833281>æ ‡ç­¾</h6></div></div> <hr data-v-03833281></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/å…¶ä»–/" class="nav-link"><i class="iconfont undefined"></i>
  å…¶ä»–
</a></li><li class="dropdown-item"><!----> <a href="/categories/æ”¶è—/" class="nav-link"><i class="iconfont undefined"></i>
  æ”¶è—
</a></li><li class="dropdown-item"><!----> <a href="/categories/å‰ç«¯/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯
</a></li><li class="dropdown-item"><!----> <a href="/categories/å®‰è£…/" class="nav-link"><i class="iconfont undefined"></i>
  å®‰è£…
</a></li><li class="dropdown-item"><!----> <a href="/categories/ç¬”è®°/" class="nav-link"><i class="iconfont undefined"></i>
  ç¬”è®°
</a></li><li class="dropdown-item"><!----> <a href="/categories/è¸©å‘/" class="nav-link"><i class="iconfont undefined"></i>
  è¸©å‘
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´è½´
</a></div><div class="nav-item"><a href="/view/reward/" class="nav-link"><i class="iconfont undefined"></i>
  å¥–åŠ±
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  å…³äº
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-5cb9a64e data-v-faf1ae92><h3 class="title" style="display:none;" data-v-5cb9a64e data-v-5cb9a64e>Redisç¬”è®°</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-5cb9a64e data-v-5cb9a64e><input type="password" value="" data-v-5cb9a64e> <span data-v-5cb9a64e>Konck! Knock!</span> <button data-v-5cb9a64e>OK</button></label> <div class="footer" style="display:none;" data-v-5cb9a64e data-v-5cb9a64e><span data-v-5cb9a64e><i class="iconfont reco-theme" data-v-5cb9a64e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-5cb9a64e>vuePress-theme-reco</a></span> <span data-v-5cb9a64e><i class="iconfont reco-copyright" data-v-5cb9a64e></i> <a data-v-5cb9a64e><span data-v-5cb9a64e>ğŸˆ</span>
          Â Â 
          <span data-v-5cb9a64e>2021 - </span>
          2023
        </a></span></div></div></div> <div data-v-faf1ae92><main class="page"><div class="page-title" style="display:none;"><h1 class="title">Redisç¬”è®°</h1> <div class="page-info" data-v-0efa1f05><i class="iconfont reco-account" data-v-0efa1f05><span data-v-0efa1f05>ğŸˆ</span></i> <i class="iconfont reco-date" data-v-0efa1f05><span data-v-0efa1f05>2021-10-29</span></i> <i class="iconfont reco-eye" data-v-0efa1f05><span id="/view/docs/%E7%AC%94%E8%AE%B0/32.Redis6.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-0efa1f05><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-0efa1f05><span class="tag-item" data-v-0efa1f05>Redis</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="nosqlç®€ä»‹"><a href="#nosqlç®€ä»‹" class="header-anchor">#</a> <strong>NoSQLç®€ä»‹</strong></h2> <p>éå…³ç³»æ•°æ®åº“ï¼Œä»¥ç®€å•key-valueå­˜å‚¨ï¼Œä¸æ”¯æŒsqlæ ‡å‡†ï¼Œä¸æ”¯æŒ<strong>ACID</strong>,æ€§èƒ½è¿œè¶…SQLã€‚</p> <p>ACID(åŸå­æ€§ï¼Œä¸€è‡´æ€§ï¼Œéš”ç¦»æ€§ï¼ŒæŒä¹…æ€§)</p> <p><strong>é€‚åˆåœºæ™¯</strong>ï¼š</p> <ul><li>å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™ã€‚</li> <li>æµ·é‡æ•°æ®è¯»å†™ã€‚</li> <li>å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§ã€‚</li></ul> <blockquote><p>ä¸é€‚åˆäº‹åŠ¡æ”¯æŒï¼Œå¤„ç†å¤æ‚å…³ç³»ï¼Œéœ€è¦å³å¸­æŸ¥è¯¢ã€‚</p></blockquote> <p><strong>å¸¸è§nosql</strong>ï¼šmemcacheã€<strong>redis</strong>ã€<strong>MongoDB</strong></p> <p>è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼šï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰</p> <ul><li>è¡Œå¼æ•°æ®åº“ï¼šæ ¹æ®idå¿« èšåˆæ…¢</li> <li>åˆ—å¼æ•°æ®åº“ï¼šOLAPåˆ†æå¿«ã€OLTPäº‹åŠ¡æ…¢</li></ul> <p>å…¶ä»–nosqlï¼šHBaseã€Apche Cassandraã€å›¾å…³ç³»å‹æ•°æ®åº“ã€</p> <h2 id="rediså®‰è£…å’Œæ¦‚è¿°"><a href="#rediså®‰è£…å’Œæ¦‚è¿°" class="header-anchor">#</a> Rediså®‰è£…å’Œæ¦‚è¿°</h2> <p>redisæ˜¯å¼€æºçš„key-valueå­˜å‚¨ç³»ç»Ÿï¼Œæ“ä½œåŸå­æ€§ï¼Œæ’åºï¼Œç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå‘¨æœŸæ›´æ–°æ•°æ®å†™å…¥ç£ç›˜ï¼Œå¯å®ç°ä¸»ä»åŒæ­¥ã€‚</p> <p><strong>åœºæ™¯</strong>ï¼šé…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜ï¼Œå¤šæ ·æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ®</p> <p><strong>å®‰è£…</strong>ï¼š</p> <ul><li><p>ä¸‹è½½ä¸Šä¼ è§£å‹ :<a href="https://redis.io/" target="_blank" rel="noopener noreferrer">https://redis.io/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>å®‰è£…cè¯­è¨€ç¼–è¯‘ç¯å¢ƒ  gcc</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> centos-release-scl scl-utils-build
yum <span class="token function">install</span> -y devtoolset-8-toolchain
scl <span class="token builtin class-name">enable</span> devtoolset-8 <span class="token function">bash</span>

æˆ–è€… yum <span class="token function">install</span> gcc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#æŸ¥çœ‹</span>
gcc --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>åœ¨redisè·Ÿç›®å½•ä¸‹æ‰§è¡Œmakeå‘½ä»¤  ç¼–è¯‘</p> <blockquote><p>å¦‚æœç¯å¢ƒæ²¡è£…æŠ¥é”™ï¼Œå…ˆè£…å¥½</p> <p>è¿è¡Œæ¸…é™¤ <code>make distclean</code>   å†é‡æ–°ç¼–è¯‘ï¼Œmake</p></blockquote></li> <li><p>å®‰è£… make install</p> <blockquote><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local/bin
<span class="token function">ls</span>  <span class="token comment">#æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span>

redis-benchmark:æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥åœ¨è‡ªå·±æœ¬å­è¿è¡Œï¼Œçœ‹çœ‹è‡ªå·±æœ¬å­æ€§èƒ½å¦‚ä½•
redis-check-aofï¼šä¿®å¤æœ‰é—®é¢˜çš„AOFæ–‡ä»¶ï¼Œrdbå’Œaofåé¢è®²
redis-check-dumpï¼šä¿®å¤æœ‰é—®é¢˜çš„dump.rdbæ–‡ä»¶
redis-sentinelï¼šRedisé›†ç¾¤ä½¿ç”¨
redis-serverï¼šRedisæœåŠ¡å™¨å¯åŠ¨å‘½ä»¤
redis-cliï¼šå®¢æˆ·ç«¯ï¼Œæ“ä½œå…¥å£
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></blockquote></li> <li><p>å¯åŠ¨ï¼šæœåŠ¡ç«¯</p> <blockquote><p>å‰å°ï¼šredis-server</p> <p>åå°ï¼ˆæ¨èï¼‰ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#æ‹·è´ä¿®æ”¹é…ç½®æ–‡ä»¶ redis.conf</span>
<span class="token function">sudo</span> <span class="token function">cp</span> redis.conf /etc/redis.conf
<span class="token function">sudo</span> <span class="token function">vim</span> redis.conf
	<span class="token comment">#ä¿®æ”¹ï¼ˆ128è¡Œï¼‰</span>
	daemonize <span class="token function">yes</span>  

<span class="token comment">#å¯åŠ¨  redis-server /etc/redis.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æŸ¥çœ‹è¿›ç¨‹:<code>ps -ef | grep redis</code></p></blockquote></li> <li><p>å¯åŠ¨ï¼šå®¢æˆ·ç«¯ï¼šredis-cli</p> <blockquote><p>æµ‹è¯•ï¼š  ping        =&gt;PONG</p></blockquote></li> <li><p>å…³é—­ï¼š</p> <blockquote><p>å•å®ä¾‹å…³é—­ï¼šredis-cli shutdown</p> <p>å¤šå®ä¾‹å…³é—­ï¼ŒæŒ‡å®šç«¯å£å…³é—­ï¼šredis-cli -p 6379 shutdown</p> <p>æŸ¥çœ‹ï¼šps -ef | grep redis</p> <p>ç„¶åå†kill æ€æ‰è¿›ç¨‹</p></blockquote></li></ul> <p><strong>å…¶ä»–ç›¸å…³çŸ¥è¯†</strong></p> <p>ç«¯å£å·6379ï¼Œé»˜è®¤æ˜¯16ä¸ªæ•°æ®åº“ï¼Œåˆå§‹åŒ–ç”¨0å·åº“ï¼Œç”¨<code>select &lt;dbid&gt;</code> åˆ‡æ¢ æ‰€æœ‰åº“å¯†ç ç›¸åŒï¼Œ<code>dbsize</code>æŸ¥çœ‹å½“å‰æ•°æ®åº“keyæ•°é‡ï¼Œ<code>flushdb</code>æ¸…ç©ºå½“å‰åº“ï¼Œ<code>flushall</code>é€šæ€å…¨éƒ¨åº“ã€‚</p> <p>Redisæ˜¯å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨æŠ€æœ¯ã€‚</p> <h2 id="å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹"><a href="#å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹" class="header-anchor">#</a> å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹</h2> <p><strong>é”®keyæ“ä½œ</strong>ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>keys * æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key    <span class="token punctuation">(</span>åŒ¹é…ï¼škeys *1<span class="token punctuation">)</span>
exists key åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨
<span class="token builtin class-name">type</span> key æŸ¥çœ‹ä½ çš„keyæ˜¯ä»€ä¹ˆç±»å‹
del key       åˆ é™¤æŒ‡å®šçš„keyæ•°æ®
unlink key   æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤
ä»…å°†keysä»keyspace å…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œã€‚

expire key <span class="token number">10</span>   <span class="token number">10</span>ç§’é’Ÿï¼šä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´
ttl key æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ

<span class="token keyword">select</span> å‘½ä»¤åˆ‡æ¢æ•°æ®åº“
dbsize æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡
flushdb æ¸…ç©ºå½“å‰åº“
flushall é€šæ€å…¨éƒ¨åº“
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>å­—ç¬¦ä¸²String</strong>ï¼šæ˜¯æœ€åŸºæœ¬ç±»å‹ï¼Œæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå¯ä¿å­˜jpså›¾ç‰‡æˆ–è€…åºåˆ—åŒ–å¯¹è±¡ç­‰</p> <ul><li><p>set ä¸å­˜åœ¨æ·»åŠ ï¼Œå­˜åœ¨ä¿®æ”¹</p></li> <li><p>get æŸ¥è¯¢å¯¹åº”é”®å€¼</p></li> <li><p>append  è¿½åŠ </p></li> <li><p>strlen   è·å–å€¼çš„é•¿åº¦</p></li> <li><p>setnx   å½“keyä¸å­˜åœ¨æ—¶ï¼Œæ‰èƒ½è®¾ç½®keyå€¼</p></li> <li><p>incr    å°†keyä¸­å­˜å‚¨çš„å€¼è®¾ç½®åœ¨åŸæ¥åŸºç¡€ä¸Š+1ï¼Œæ‰€æœ‰è¦æ±‚å€¼æ˜¯intç±»å‹</p></li> <li><p>decr å‡ä¸€</p></li> <li><p>incrbyã€decrby   ã€key   æ­¥é•¿ã€‘ è®¾ç½®åŠ å‡çš„æ­¥é•¿</p> <blockquote><p>åŸå­æ“ä½œï¼šä¸è¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œ (å› ä¸ºæ˜¯redisæ˜¯å•çº¿ç¨‹çš„)</p></blockquote></li> <li><p>mset åŒæ—¶è®¾ç½®ä¸€æˆ–å¤šä¸ªk-v</p></li> <li><p>mget åŒæ—¶è·å–ä¸€æˆ–å¤šä¸ªk-v</p> <blockquote><p>åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥éƒ½å¤±è´¥</p></blockquote></li> <li><p>getrange  ã€key èµ·å§‹ä½ç½® ç»“æŸä½ç½®ã€‘ è·å–èŒƒå›´å€¼</p></li> <li><p>setrange  ã€key èµ·å§‹ä½ç½® å†…å®¹ã€‘è¦†ç›–èŒƒå›´å€¼</p></li> <li><p>setex ã€key è¿‡æœŸæ—¶é—´  å†…å®¹ã€‘ è®¾ç½®è¿‡æœŸæ—¶é—´    ttlæŸ¥çœ‹è¿‡æœŸæ—¶é—´</p></li> <li><p>getex  ä¿®æ”¹è¿‡æœŸæ—¶é—´</p></li></ul> <p><strong>åˆ—è¡¨List</strong>:  <strong>å•é”®å¤šå€¼</strong></p> <ul><li>lpushã€rpush  å·¦æ’å…¥å³æ’å…¥  <strong>1ä¸ªæˆ–å¤šä¸ªå€¼</strong>ã€‚</li> <li>lpopã€rpop å·¦å³åå‡ºä¸€ä¸ªå€¼ã€‚å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®ç‹</li> <li>lrange  ã€key èµ·å§‹ä½ç½® ç»“æŸä½ç½®ã€‘ èŒƒå›´å–å€¼   -1æ ‡è¯†å³è¾¹ç¬¬ä¸€ä¸ª</li> <li>rpoplpush ã€key1 key2ã€‘ ä»åˆ—è¡¨key1å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°key2åˆ—è¡¨çš„å·¦è¾¹</li> <li>index ã€keyï¼Œindexã€‘ æŒ‡å®šè·å–é•¿åº¦ä¸‹æ ‡å€¼</li> <li>llen ã€keyã€‘ è·å–åˆ—è¡¨é•¿åº¦</li> <li>linsert ã€keyã€‘ before ã€value newvalueã€‘åœ¨valueåé¢æ’å…¥newvalueå€¼</li> <li>lrem ã€key n valueã€‘ä»å·¦è¾¹åˆ é™¤nä¸ªvalue</li> <li>lset ã€key index valueã€‘å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue</li></ul> <blockquote><p>listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨quicklist</p></blockquote> <p><strong>é›†åˆSet</strong>ï¼š<strong>è‡ªåŠ¨æ’é‡ï¼Œä¸å­˜åœ¨é‡å¤å€¼</strong>  æ˜¯stringç±»å‹çš„æ— åºé›†åˆ</p> <ul><li>sadd  æ·»åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ªå€¼</li> <li>smembers   å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼</li> <li>sismember ã€ key valueã€‘åˆ¤æ–­é›†åˆkeyæ˜¯å¦ä¸ºå«æœ‰è¯¥valueå€¼ï¼Œæœ‰1ï¼Œæ²¡æœ‰0</li> <li>scard  è¿”å›è¯¥å…ƒç´ çš„ä¸ªæ•°</li> <li>srem åˆ é™¤é›†åˆçš„æŸä¸ªæˆ–å¤šä¸ªå…ƒç´ </li> <li>spop éšæœºåå‡ºä¸€ä¸ªå€¼</li> <li>srandmember ã€key nã€‘éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ã€‚ä¸ä¼šä»é›†åˆä¸­åˆ é™¤</li> <li>smove ã€source destination valueã€‘æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆ</li> <li>sinter ã€key1 key2ã€‘è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ ã€‚</li> <li>sunion ã€k1 k2ã€‘è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ ã€‚</li> <li>sdiff ã€k1 k2ã€‘è¿”å›ä¸¤ä¸ªé›†åˆçš„****å·®é›†****å…ƒç´ (key1ä¸­çš„ï¼Œä¸åŒ…å«key2ä¸­çš„)</li></ul> <blockquote><p>Setæ•°æ®ç»“æ„æ˜¯dictå­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„</p></blockquote> <p><strong>å“ˆå¸ŒHash</strong>ï¼šæ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚</p> <blockquote><p>æ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ç±»ä¼¼Javaé‡Œé¢çš„Map&lt;String,Object&gt;</p></blockquote> <ul><li><p>hset ã€key   f,v ã€‘ æ·»åŠ </p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#ä¾‹</span>
hset user:1001 <span class="token function">id</span> <span class="token number">1</span>
hset user:1001 name å¼ ä¸‰
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>hget ã€key fã€‘ å–å€¼</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hget user:1001 id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>hmset ã€k  f1,v1, f2 ,v2ã€‘æ‰¹é‡è®¾ç½®</p></li> <li><p>hexists  åˆ¤æ–­fæ˜¯å¦å­˜åœ¨</p></li> <li><p><code>hkeys &lt;key&gt;</code>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</p></li> <li><p><code>hvals &lt;key&gt;</code>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</p></li> <li><p><code>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;</code>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ 1  -1</p></li> <li><p><code>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;</code>å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨</p></li></ul> <blockquote><p>Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“field-valueé•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtableã€‚</p></blockquote> <p><strong>æœ‰åºé›†åˆZset</strong>:æ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆ</p> <ul><li>zadd  ã€k1ï¼Œs1,v1 ,s2,v2..ã€‘æ·»åŠ </li> <li>zrange ã€èµ·å§‹ä½ç½® ç»“æŸä½ç½®  withscoresã€‘ å–å€¼ ï¼ˆ0 -1ï¼‰å…¨éƒ¨ withscoresæ˜¾ç¤ºåˆ†æ•°</li> <li>zrangebyscore key ã€å€¼1ï¼Œå€¼2ã€‘ å–å‡ºå€¼1åˆ°å€¼2èŒƒå›´ä¹‹é—´å€¼ withscoresæ˜¾ç¤ºåˆ†æ•°</li> <li>zrevrangebyscore key maxmin [withscores] [limit offset count]     å€’åº</li> <li>zincrby <code>&lt;key&gt;&lt;increment&gt;&lt;value&gt;</code>    ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡</li> <li>zrem  <code>&lt;key&gt;&lt;value&gt;</code>åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´ </li> <li>zcount <code>&lt;key&gt;&lt;min&gt;&lt;max&gt;</code>ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°</li> <li>zrank <code>&lt;key&gt;&lt;value&gt;</code>è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹</li></ul> <blockquote><p>é‡‡ç”¨hashå’Œè·³è·ƒè¡¨ï¼ˆæœ‰åºé“¾è¡¨ã€è·³è·ƒè¡¨ï¼‰</p></blockquote> <h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="header-anchor">#</a> é…ç½®æ–‡ä»¶</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>è‡ªå®šä¹‰ç›®å½•ï¼š/myredis/redis.conf
å•ä½ï¼šé…ç½®å¤§å°å•ä½,å¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œåªæ”¯æŒbytesï¼Œä¸æ”¯æŒbitï¼Œå¤§å°å†™ä¸æ•æ„Ÿ
åŒ…å«ï¼šç±»ä¼¼jspä¸­çš„includeï¼Œå¤šå®ä¾‹çš„æƒ…å†µå¯ä»¥æŠŠå…¬ç”¨çš„é…ç½®æ–‡ä»¶æå–å‡ºæ¥

<span class="token comment">###ç½‘ç»œç›¸å…³é…ç½® ###</span>
bindï¼š é»˜è®¤æƒ…å†µbind<span class="token operator">=</span><span class="token number">127.0</span>.0.1åªèƒ½æ¥å—æœ¬æœºçš„è®¿é—®è¯·æ±‚ï¼Œä¸å†™çš„æƒ…å†µä¸‹ï¼Œæ— é™åˆ¶æ¥å—ä»»ä½•ipåœ°å€çš„è®¿é—®
å¦‚æœå¼€å¯äº†protected-modeï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰è®¾å®šbind ipä¸”æ²¡æœ‰è®¾å¯†ç çš„æƒ…å†µä¸‹ï¼ŒRedisåªå…è®¸æ¥å—æœ¬æœºçš„å“åº”
Portï¼šç«¯å£å·ï¼Œé»˜è®¤ <span class="token number">6379</span>
tcp-backlogï¼šå…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklogé˜Ÿåˆ—æ€»å’Œ<span class="token operator">=</span>æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—
timeoutï¼šä¸€ä¸ªç©ºé—²çš„å®¢æˆ·ç«¯ç»´æŒå¤šå°‘ç§’ä¼šå…³é—­ï¼Œ0è¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚å³æ°¸ä¸å…³é—­ã€‚
tcp-keepaliveï¼šå¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§å¿ƒè·³æ£€æµ‹ï¼Œæ¯ä¸ªnç§’æ£€æµ‹ä¸€æ¬¡ã€‚å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒKeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60 

<span class="token comment">###GENERALé€šç”¨###</span>
daemonizeï¼šæ˜¯å¦ä¸ºåå°è¿›ç¨‹ï¼Œè®¾ç½®ä¸ºyesï¼Œå®ˆæŠ¤è¿›ç¨‹ï¼Œåå°å¯åŠ¨
pidfileï¼šå­˜æ”¾pidæ–‡ä»¶çš„ä½ç½®ï¼Œæ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„pidæ–‡ä»¶
loglevelï¼šæŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸ºnotice
å››ä¸ªçº§åˆ«æ ¹æ®ä½¿ç”¨é˜¶æ®µæ¥é€‰æ‹©ï¼Œç”Ÿäº§ç¯å¢ƒé€‰æ‹©notice æˆ–è€…warning
logfileï¼šæ—¥å¿—æ–‡ä»¶åç§°
databases: <span class="token number">16</span>  è®¾å®šåº“çš„æ•°é‡ é»˜è®¤16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT <span class="token operator">&lt;</span>dbid<span class="token operator">&gt;</span>å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id

<span class="token comment">###SECURITYå®‰å…¨###</span>
è®¾ç½®å¯†ç ï¼šrequirepass

<span class="token comment">#### LIMITSé™åˆ¶ ###</span>
maxclients:è®¾ç½®redisåŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º10000ä¸ªå®¢æˆ·ç«¯
maxmemory:å»ºè®®å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™ï¼Œå°†å†…å­˜å æ»¡ï¼Œé€ æˆæœåŠ¡å™¨å®•æœº
maxmemory-policy:
	ïƒ˜volatile-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰
	ïƒ˜allkeys-lruï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤key
	ïƒ˜volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®
	ïƒ˜allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œç§»é™¤éšæœºçš„key
	ïƒ˜volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„key
	ïƒ˜noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯
maxmemory-samples:
	ïƒ˜è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredisé»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ªkeyå¹¶é€‰æ‹©å…¶ä¸­LRUçš„é‚£ä¸ªã€‚
	ïƒ˜ä¸€èˆ¬è®¾ç½®3åˆ°7çš„æ•°å­—ï¼Œæ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå°ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="å‘å¸ƒå’Œè®¢é˜…"><a href="#å‘å¸ƒå’Œè®¢é˜…" class="header-anchor">#</a> å‘å¸ƒå’Œè®¢é˜…</h2> <p>æ˜¯ä¸€ç§æ¶ˆæ¯çš„é€šä¿¡æ¨¡å¼ï¼špubå‘é€å°æ•°ï¼Œsubæ¥æ”¶æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å¯è®¢é˜…ä»»æ„ï¼Œå¤šä¸ªé¢‘é“</p> <p>å‘½ä»¤è¡Œæ“ä½œï¼š</p> <ul><li>è®¢é˜…ï¼šSUBSCRIBE é¢‘é“</li> <li>å‘é€ï¼špublish é¢‘é“ å†…å®¹</li></ul> <h2 id="æ–°ç±»å‹-åŠŸèƒ½"><a href="#æ–°ç±»å‹-åŠŸèƒ½" class="header-anchor">#</a> æ–°ç±»å‹&amp;åŠŸèƒ½</h2> <p><strong>ç±»å‹</strong>ï¼šBitmapsã€HyperLogLogã€Geospatial</p> <ul><li><p>Bitmapsï¼šå®ç°å¯¹ä½çš„æ“ä½œ çš„å­—ç¬¦ä¸²   ç»Ÿè®¡ç»ƒä¹ è®¿é—®çš„ç”¨æˆ·</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>å‘½ä»¤ï¼š
setbit<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span>offset<span class="token operator">&gt;</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>è®¾ç½®Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆ0æˆ–1ï¼‰  å¯ç»Ÿè®¡ç”¨æˆ·è®¿é—®é‡
getbit<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span>offset<span class="token operator">&gt;</span>è·å–Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ ä»0å¼€å§‹
bitcount<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token punctuation">[</span>start end<span class="token punctuation">]</span> ç»Ÿè®¡å­—ç¬¦ä¸²ä»startå­—èŠ‚åˆ°endå­—èŠ‚æ¯”ç‰¹å€¼ä¸º1çš„æ•°é‡ã€‚
bitop  and<span class="token punctuation">(</span>or/not/xor<span class="token punctuation">)</span> <span class="token operator">&lt;</span>destkey<span class="token operator">&gt;</span> <span class="token punctuation">[</span>keyâ€¦<span class="token punctuation">]</span> 
bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„andï¼ˆäº¤é›†ï¼‰ ã€ orï¼ˆå¹¶é›†ï¼‰ ã€ notï¼ˆéï¼‰ ã€ xorï¼ˆå¼‚æˆ–ï¼‰ æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚
å’Œsetå¯¹æ¯”ï¼Œæ•°é‡å¤§ç”¨Bitmaps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>HyperLogLogï¼šç»Ÿè®¡éœ€æ±‚         ç»Ÿè®¡pvç­‰  é‡å¤å»é‡</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>å‘½ä»¤ï¼š
pfadd <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span> element<span class="token operator">&gt;</span> <span class="token punctuation">[</span>element <span class="token punctuation">..</span>.<span class="token punctuation">]</span>   æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­
pfcount<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span> <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> è®¡ç®—HLLçš„è¿‘ä¼¼åŸºæ•°ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªHLLï¼Œæ¯”å¦‚ç”¨HLLå­˜å‚¨æ¯å¤©çš„UVï¼Œè®¡ç®—ä¸€å‘¨çš„UVå¯ä»¥ä½¿ç”¨7å¤©çš„UVåˆå¹¶è®¡ç®—å³å¯ã€‚
pfmerge<span class="token operator">&lt;</span>destkey<span class="token operator">&gt;</span><span class="token operator">&lt;</span>sourcekey<span class="token operator">&gt;</span> <span class="token punctuation">[</span>sourcekey <span class="token punctuation">..</span>.<span class="token punctuation">]</span>  å°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾—
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Geospatialï¼šåœ°ç†ä¿¡æ¯çš„æ“ä½œã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„2ç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚  å¯è®¡ç®—ä¸¤åœ°çš„è·ç¦»</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>å‘½ä»¤ï¼š
geoadd<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span> longitude<span class="token operator">&gt;</span><span class="token operator">&lt;</span>latitude<span class="token operator">&gt;</span><span class="token operator">&lt;</span>member<span class="token operator">&gt;</span> <span class="token punctuation">[</span>longitude latitude member<span class="token punctuation">..</span>.<span class="token punctuation">]</span>   æ·»åŠ åœ°ç†ä½ç½®ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œåç§°ï¼‰
geopos  <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span>member<span class="token operator">&gt;</span> <span class="token punctuation">[</span>member<span class="token punctuation">..</span>.<span class="token punctuation">]</span>  è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼
geodist<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span>member<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token operator">&lt;</span>member<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>  <span class="token punctuation">[</span>m<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">]</span>  è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»
							å•ä½ï¼š
								m è¡¨ç¤ºå•ä½ä¸ºç±³<span class="token punctuation">[</span>é»˜è®¤å€¼<span class="token punctuation">]</span>ã€‚
								km è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚
								mi è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚
								ft è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚
								
georadius<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span> longitude<span class="token operator">&gt;</span><span class="token operator">&lt;</span>latitude<span class="token operator">&gt;</span>radius  m<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi   ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ul> <p><strong>æ–°åŠŸèƒ½</strong>ï¼šACL(è®¿é—®æƒé™ç­‰)ã€IOå¤šçº¿ç¨‹ã€å·¥å…·æ”¯æŒCluster</p> <h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="header-anchor">#</a> æ“ä½œ</h2> <h3 id="jedisæ“ä½œredis"><a href="#jedisæ“ä½œredis" class="header-anchor">#</a> jedisæ“ä½œredis</h3> <ul><li><p>åŸºæœ¬æ“ä½œ</p> <blockquote><p>ç¦ç”¨Linuxçš„é˜²ç«å¢™ï¼šLinux(CentOS7)é‡Œæ‰§è¡Œå‘½ä»¤</p> <p><em><strong>*systemctl stop/disable firewalld.service*</strong></em></p> <p>redis.confä¸­æ³¨é‡Šæ‰bind 127.0.0.1 ,ç„¶å protected-mode no</p></blockquote> <p>ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisDemo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ›å»ºjediså¯¹è±¡</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> value <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ“ä½œkey</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ·»åŠ </span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–</span>
        <span class="token class-name">String</span> name1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è®¾ç½®å¤šä¸ªkeyå’Œvalue</span>
        jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mget <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mget<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keys<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ“ä½œstring</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dome2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> k1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ“ä½œset</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dome3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;set2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> key3 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ“ä½œhash</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dome4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;åŒ—äº¬&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;key4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;å¼ ä¸‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;key4&quot;</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">&quot;key4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//æ“ä½œzset</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dome5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;key5&quot;</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;å¼ ä¸‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> key5 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">&quot;key5&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div></li> <li><p>æ¡ˆä¾‹ éªŒè¯ç è¯†åˆ«</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneCode</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        System.out.println(getCode());//æµ‹è¯•</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¾“å…¥æ‰‹æœºå·:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> phone <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verifyCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯ç ä»¥å‘é€,è¯·è¾“å…¥éªŒè¯ç ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getRedisCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span>scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
    <span class="token comment">//1. ç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç </span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuffer</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//2.è®¾ç½®éªŒè¯</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token keyword">void</span> <span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//è¿æ¥</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‹¼æ¥æ‰‹æœºå‘ç”Ÿæ¬¡æ•°çš„key</span>
        <span class="token class-name">String</span> countKey<span class="token operator">=</span><span class="token string">&quot;VerifyCode&quot;</span><span class="token operator">+</span>phone<span class="token operator">+</span><span class="token string">&quot;:count&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//éªŒè¯ç çš„key</span>
        <span class="token class-name">String</span> codeKey<span class="token operator">=</span><span class="token string">&quot;VerifyCode&quot;</span><span class="token operator">+</span>phone<span class="token operator">+</span><span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¯ä¸ªæ‰‹æœºåªèƒ½å‘ä¸‰æ¬¡</span>
        <span class="token class-name">String</span> count <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//ç¬¬ä¸€æ¬¡å‘ç”Ÿ</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>countKey<span class="token punctuation">,</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">^</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//å‘ç”Ÿæ¬¡æ•°åŠ 1</span>
            jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//å‘ç”Ÿå·²ç»åˆ°è¾¾ä¸‰æ¬¡äº†ï¼›</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»Šå¤©å‘é€æ¬¡æ•°å·²ç»è¶…è¿‡ä¸‰æ¬¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//éªŒè¯ç æ”¾åˆ°redisé‡Œé¢</span>
        <span class="token class-name">String</span> code1 <span class="token operator">=</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”ŸæˆéªŒè¯ç ï¼š&quot;</span><span class="token operator">+</span>code1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span>code1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token comment">//3. éªŒè¯ç æ£€éªŒ</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getRedisCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;hadoop111&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//éªŒè¯ç key</span>
        <span class="token class-name">String</span> codekey<span class="token operator">=</span><span class="token string">&quot;VerifyCode&quot;</span><span class="token operator">+</span>phone<span class="token operator">+</span><span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> redisCode<span class="token operator">=</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>codekey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div></li></ul> <h3 id="æ•´åˆsparingboot"><a href="#æ•´åˆsparingboot" class="header-anchor">#</a> æ•´åˆSparingboot</h3> <ul><li><p>ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- redis --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>é…ç½®</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#application.propertiesé…ç½®redisé…ç½®</span>
<span class="token comment">#RedisæœåŠ¡å™¨åœ°å€</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.140.136</span>
<span class="token comment">#RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
<span class="token comment">#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span>
<span class="token attr-name">spring.redis.database</span><span class="token punctuation">=</span> <span class="token attr-value">0</span>
<span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
<span class="token attr-name">spring.redis.timeout</span><span class="token punctuation">=</span><span class="token attr-value">1800000</span>
<span class="token comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-active</span><span class="token punctuation">=</span><span class="token attr-value">20</span>
<span class="token comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-wait</span><span class="token punctuation">=</span><span class="token attr-value">-1</span>
<span class="token comment">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-idle</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token comment">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
<span class="token attr-name">spring.redis.lettuce.pool.min-idle</span><span class="token punctuation">=</span><span class="token attr-value">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>ç¼–å†™ä»£ç </p> <p>é…ç½®ç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//keyåºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//valueåºåˆ—åŒ–</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//value hashmapåºåˆ—åŒ–</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/redisTest&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è®¾ç½®å€¼åˆ°redis</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä»redisè·å–å€¼</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ul> <h2 id="äº‹åŠ¡ğŸ‡"><a href="#äº‹åŠ¡ğŸ‡" class="header-anchor">#</a> äº‹åŠ¡ğŸ‡</h2> <p>ä¸»è¦ä½œç”¨ï¼šä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</p> <p><strong>multi</strong>ï¼šè¾“å…¥çš„å‘½ä»¤ä¼šä¾æ¬¡æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼ˆç»„é˜Ÿï¼‰ï¼Œä½†ä¸ä¼šæ‰§è¡Œ</p> <p><strong>exec</strong>ï¼šæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤</p> <p><strong>discard</strong>ï¼šæ”¾å¼ƒç»„é˜Ÿ</p> <p><strong>é”™è¯¯</strong>ï¼š</p> <blockquote><p>ç»„é˜Ÿæ—¶ï¼Œè¾“å…¥çš„å‘½ä»¤æŠ¥é”™ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªé˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚</p> <p>ç»„é˜Ÿæ—¶ï¼Œä¸æŠ¥é”™ï¼Œè¿è¡Œæ—¶æŠ¥é”™ï¼ŒæŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</p></blockquote> <p><strong>å†²çª</strong>ï¼šé”</p> <ul><li><p>æ‚²è§‚é”ï¼šæ“ä½œæ—¶å µå¡ï¼Œæ“ä½œå®Œé‡Šæ”¾ï¼ˆæ¯æ¬¡è®¿é—®éƒ½ä¼šä¸Šé”ï¼Œå¹¶å‘æ€§é™ä½ï¼‰ä¾‹ï¼šè¡Œé”ã€è¡¨é”ã€è¯»å†™é”</p></li> <li><p>ä¹è§‚é”ï¼šåŠ ç‰ˆæœ¬å·ï¼Œä¿®æ”¹åŒæ­¥æ›´æ–°ã€‚å¦‚æœç‰ˆæœ¬å·ä¸ä¸€æ ·ï¼Œä¸æ“ä½œï¼Œå¯æé«˜ååé‡</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>åœ¨æ‰§è¡Œmulitä¹‹å‰å…ˆæ‰§è¡Œ <span class="token function">watch</span> key1 <span class="token punctuation">[</span>key2<span class="token punctuation">]</span> ç›‘å¬å¤šä¸ªkey
æ‰§è¡Œä¹‹å‰è¿™äº›keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œäº‹åŠ¡å°†ä¼šè¢«æ‰“æ–­ã€‚

unwatch å–æ¶ˆç›‘è§†
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <p><strong>äº‹åŠ¡ä¸‰ç‰¹æ€§</strong>ï¼š</p> <ul><li>å•ç‹¬éš”ç¦»æ“ä½œï¼šæ‰€æœ‰ç›®å½•éƒ½ä¼šåºåˆ—åŒ–ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«æ‰“æ–­</li> <li>æ²¡æœ‰éš”ç¦»çº§åˆ«æ¦‚å¿µ</li> <li>ä¸ä¿è¯åŸå­æ€§ï¼šå¦‚æœäº‹åŠ¡ä¸­æœ‰æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»šã€‚</li></ul> <p><strong>ç§’æ€æ¡ˆä¾‹</strong>:</p> <p>è¿æ¥è¶…æ—¶ï¼šè¿æ¥æ± </p> <p>è¶…å–ï¼šä¹è§‚é”+äº‹åŠ¡</p> <p>åº“å­˜é—ç•™ï¼š luaè„šæœ¬ åµŒå…¥å¼è„šæœ¬è¯­è¨€</p> <blockquote><p>å¯ä»¥å°†å¤ç‚¸å¤šæ­¥çš„redisæ“ä½œå†™æˆä¸€ä¸ªè„šæœ¬æäº¤ç»™redisæ‰§è¡Œï¼Œluaè„šæœ¬ç±»ä¼¼redisäº‹åŠ¡ã€‚</p></blockquote> <h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="header-anchor">#</a> æŒä¹…åŒ–</h2> <h3 id="rdb"><a href="#rdb" class="header-anchor">#</a> <strong>RDB</strong></h3> <p>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œæ¢å¤è¯»å–ç¡¬ç›˜æ•°æ®åˆ°å†…å­˜</p> <blockquote><p>Redisä¼šå•ç‹¬åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹<strong>fork</strong>æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œå°†æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–ç»“æŸï¼Œå†ç”¨æ•´ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šä¼ æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ï¼Œä¸»çº¿ç¨‹ä¸è¿›è¡Œioæ“ä½œï¼Œç¡®ä¿äº†æ€§èƒ½ï¼ŒRDBæ¯”AOFæ›´åŠ é«˜æ•ˆã€‚</p> <p><strong>fork</strong>:å†™æ—¶å¤åˆ¶æŠ€æœ¯</p></blockquote> <p>ç¼ºç‚¹ï¼šæœ€åä¾æ¬¡æŒä¹…åŒ–åæ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚</p> <p><strong>æµç¨‹</strong>ï¼š</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030150721.png" alt=""></p> <p><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong>ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>å­˜å‚¨æ–‡ä»¶åç§°ï¼šdump.rdbæ–‡ä»¶ï¼Œåœ¨redis.confä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸ºdump.rdb
é…ç½®ä½ç½®ï¼šrdbæ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚é»˜è®¤ä¸ºRediså¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹ <span class="token function">dir</span> <span class="token string">&quot;/myredis/&quot;</span>

<span class="token comment">#é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®</span>
save ï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚æ‰‹åŠ¨ä¿å­˜ã€‚ä¸å»ºè®®ã€‚
bgsaveï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œ å¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚
å¯ä»¥é€šè¿‡lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´

stop-writes-on-bgsave-error:å½“Redisæ— æ³•å†™å…¥ç£ç›˜çš„è¯ï¼Œç›´æ¥å…³æ‰Redisçš„å†™æ“ä½œã€‚æ¨èyes.
rdbcompression:å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ã€‚
å¦‚æœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ã€‚æ¨èyes

rdbchecksum æ£€æŸ¥å®Œæ•´æ€§
åœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®©redisä½¿ç”¨CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œ
ä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦10%çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½
æ¨èyes.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>å‘½ä»¤</strong>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>flushall:æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿdump.rdbæ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰

<span class="token comment">###SNAPSHOTTINGå¿«ç…§###</span>
save:æ ¼å¼ï¼šsave ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°
        RDBæ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„Snapshotï¼ŒRDBçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ï¼Œ
        é»˜è®¤æ˜¯1åˆ†é’Ÿå†…æ”¹äº†1ä¸‡æ¬¡ï¼Œæˆ–5åˆ†é’Ÿå†…æ”¹äº†10æ¬¡ï¼Œæˆ–15åˆ†é’Ÿå†…æ”¹äº†1æ¬¡ã€‚
        ç¦ç”¨
        ä¸è®¾ç½®saveæŒ‡ä»¤ï¼Œæˆ–è€…ç»™saveä¼ å…¥ç©ºå­—ç¬¦ä¸²
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>RDBå¤‡ä»½</strong>ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>å…ˆé€šè¿‡config get <span class="token function">dir</span>  æŸ¥è¯¢rdbæ–‡ä»¶çš„ç›®å½•
å°†*.rdbçš„æ–‡ä»¶æ‹·è´åˆ°åˆ«çš„åœ°æ–¹
rdbçš„æ¢å¤:
     ïµå…³é—­Redis
	ïµå…ˆæŠŠå¤‡ä»½çš„æ–‡ä»¶æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹ <span class="token function">cp</span> dump2.rdb dump.rdb
	ïµå¯åŠ¨Redis, å¤‡ä»½æ•°æ®ä¼šç›´æ¥åŠ è½½
ä¼˜ç‚¹ï¼šé€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼Œå¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ›´é€‚åˆä½¿ç”¨
	 èŠ‚çœç£ç›˜ç©ºé—´ï¼Œæ¢å¤é€Ÿåº¦å¿«
ç¼ºç‚¹ï¼šForkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘
	è™½ç„¶Redisåœ¨forkæ—¶ä½¿ç”¨äº†å†™æ—¶æ‹·è´æŠ€æœ¯,ä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚
	åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœRedisæ„å¤–downæ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>åœæ­¢</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>åŠ¨æ€åœæ­¢RDBï¼šredis-cli config set save &quot;&quot;#saveåç»™ç©ºå€¼ï¼Œè¡¨ç¤ºç¦ç”¨ä¿å­˜ç­–ç•¥
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>rdbæ€»ç»“</strong>ï¼š</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030151631.png" alt=""></p> <h3 id="aof"><a href="#aof" class="header-anchor">#</a> AOF</h3> <p>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œ**ï¼ˆå¢é‡ä¿å­˜ï¼‰**è¯»æ“ä½œä¸è®°å½•ï¼Œ<strong>åªå…è®¸è¿½åŠ æ–‡ä»¶</strong>ä¸å…è®¸ä¿®æ”¹æ–‡ä»¶ã€‚rediså¯åŠ¨æ—¶ä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°å‹¾é€‰æ•°æ®ã€‚</p> <p><strong>æµç¨‹</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢«appendè¿½åŠ åˆ°AOFç¼“å†²åŒºå†…ï¼›
ï¼ˆ2ï¼‰AOFç¼“å†²åŒºæ ¹æ®AOFæŒä¹…åŒ–ç­–ç•¥[always,everysec,no]å°†æ“ä½œsyncåŒæ­¥åˆ°ç£ç›˜çš„AOFæ–‡ä»¶ä¸­ï¼›
ï¼ˆ3ï¼‰AOFæ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹AOFæ–‡ä»¶rewriteé‡å†™ï¼Œå‹ç¼©AOFæ–‡ä»¶å®¹é‡ï¼›
ï¼ˆ4ï¼‰RedisæœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–°loadåŠ è½½AOFæ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„ï¼›
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>é…ç½®å¼€å¯</strong>ï¼šé»˜è®¤ä¸å¼€å¯</p> <p>å¦‚æœaofå’ŒrdbåŒæ—¶å¼€å¯ï¼Œé»˜è®¤è¯»aofæ•°æ®</p> <p><strong>å¯åŠ¨æ¢å¤å¤‡ä»½æ“ä½œ</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>AOFçš„å¤‡ä»½æœºåˆ¶å’Œæ€§èƒ½è™½ç„¶å’ŒRDBä¸åŒ, ä½†æ˜¯å¤‡ä»½å’Œæ¢å¤çš„æ“ä½œåŒRDBä¸€æ ·ï¼Œéƒ½æ˜¯æ‹·è´å¤‡ä»½æ–‡ä»¶ï¼Œéœ€è¦æ¢å¤æ—¶å†æ‹·è´åˆ°Rediså·¥ä½œç›®å½•ä¸‹ï¼Œå¯åŠ¨ç³»ç»Ÿå³åŠ è½½ã€‚
æ­£å¸¸æ¢å¤ï¼š
	ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes
	å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(æŸ¥çœ‹ç›®å½•ï¼šconfig get dir)
	æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½

å¼‚å¸¸æ¢å¤ï¼š
	ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes
	å¦‚é‡åˆ°AOFæ–‡ä»¶æŸåï¼Œé€šè¿‡/usr/local/bin/redis-check-aof--fix appendonly.aofè¿›è¡Œæ¢å¤
	å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶
	æ¢å¤ï¼šé‡å¯redisï¼Œç„¶åé‡æ–°åŠ è½½
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>åŒæ­¥é¢‘ç‡è®¾ç½®</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>appendfsync always ï¼šå§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡Redisçš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼›æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½
appendfsync everysecï¼šæ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚
appendfsync noï¼šredisä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Rewriteå‹ç¼©</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>no-appendfsync-on-rewrite=yes ,ä¸å†™å…¥aofæ–‡ä»¶åªå†™å…¥ç¼“å­˜ï¼Œç”¨æˆ·è¯·æ±‚ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯åœ¨è¿™æ®µæ—¶é—´å¦‚æœå®•æœºä¼šä¸¢å¤±è¿™æ®µæ—¶é—´çš„ç¼“å­˜æ•°æ®ã€‚
é™ä½å®‰å…¨æ€§æé«˜æ€§èƒ½

å¦‚æœ no-appendfsync-on-rewrite=no,  è¿˜æ˜¯ä¼šæŠŠæ•°æ®å¾€ç£ç›˜é‡Œåˆ·ï¼Œä½†æ˜¯é‡åˆ°é‡å†™æ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ã€‚
æ•°æ®å®‰å…¨ï¼Œæ€§èƒ½ä½
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é‡å†™æµç¨‹ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ï¼ˆ1ï¼‰bgrewriteaofè§¦å‘é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æœ‰bgsaveæˆ–bgrewriteaofåœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…è¯¥å‘½ä»¤ç»“æŸåå†ç»§ç»­æ‰§è¡Œã€‚
ï¼ˆ2ï¼‰ä¸»è¿›ç¨‹forkå‡ºå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œä¿è¯ä¸»è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚
ï¼ˆ3ï¼‰å­è¿›ç¨‹éå†rediså†…å­˜ä¸­æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚åŒæ—¶å†™å…¥aof_bufç¼“å†²åŒºå’Œaof_rewrite_bufé‡å†™ç¼“å†²åŒºä¿è¯åŸAOFæ–‡ä»¶å®Œæ•´ä»¥åŠæ–°AOFæ–‡ä»¶ç”ŸæˆæœŸé—´çš„æ–°çš„æ•°æ®ä¿®æ”¹åŠ¨ä½œä¸ä¼šä¸¢å¤±ã€‚
ï¼ˆ4ï¼‰1<span class="token punctuation">)</span>.å­è¿›ç¨‹å†™å®Œæ–°çš„AOFæ–‡ä»¶åï¼Œå‘ä¸»è¿›ç¨‹å‘ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚2<span class="token punctuation">)</span>.ä¸»è¿›ç¨‹æŠŠaof_rewrite_bufä¸­çš„æ•°æ®å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶ã€‚
ï¼ˆ5ï¼‰ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶è¦†ç›–æ—§çš„AOFæ–‡ä»¶ï¼Œå®ŒæˆAOFé‡å†™
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>aofæ€»ç»“ï¼š</p> <ul><li>ä¼˜åŠ¿ï¼šå¤‡ä»½æœºåˆ¶æ›´ç¨³å¥ã€å¯è¯»çš„æ—¥å¿—æ–‡æœ¬ï¼Œå¯å¤„ç†è¯¯æ“ä½œ</li> <li>åŠ£åŠ¿ï¼šæ¯”èµ·rdbå ç”¨æ›´å¤šç£ç›˜ç©ºé—´ï¼Œå¤‡ä»½é€Ÿåº¦æ…¢ï¼Œæ¯æ¬¡è¯»å†™åŒæ­¥æœ‰æ€§èƒ½å‹åŠ›</li></ul> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030153343.png" alt=""></p></blockquote> <p>åˆ é™¤æŒä¹…åŒ–æ•°æ®ï¼šå°†rdb,aofæ–‡ä»¶éƒ½åˆ é™¤æ‰ã€‚</p> <p><strong>æŒä¹…åŒ–æ€»ç»“</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨ã€‚
å¦‚æœå¯¹æ•°æ®ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‰å•ç‹¬ç”¨RDBã€‚
ä¸å»ºè®®å•ç‹¬ç”¨ AOFï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç°Bugã€‚
å¦‚æœåªæ˜¯åšçº¯å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥éƒ½ä¸ç”¨ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="header-anchor">#</a> ä¸»ä»å¤åˆ¶</h2> <p>ä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºï¼Œ<strong>ä¸»èŠ‚ç‚¹ä»¥å†™ä¸ºä¸»ï¼Œä»èŠ‚ç‚¹ä»¥è¯»ä¸ºä¸»</strong>ã€‚è¯»å†™åˆ†ç¦»ï¼Œæ€§èƒ½æ‰©å±•ï¼Œå®¹ç¾å¿«é€Ÿæ¢å¤ã€‚</p> <p><strong>æ­å»º</strong>ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. æ‹·è´å¤šä¸ªredis.confæ–‡ä»¶include<span class="token punctuation">(</span>å†™ç»å¯¹è·¯å¾„<span class="token punctuation">)</span>
<span class="token number">2</span>. å¼€å¯daemonize <span class="token function">yes</span>
<span class="token number">3</span>. Pidæ–‡ä»¶åå­—pidfile
<span class="token number">4</span>. æŒ‡å®šç«¯å£port
<span class="token number">5</span>. Logæ–‡ä»¶åå­—
<span class="token number">6</span>. dump.rdbåå­—dbfilename
<span class="token number">7</span>. Appendonly å…³æ‰æˆ–è€…æ¢åå­—
<span class="token number">8</span>. æ–°å»ºé…ç½®æ–‡ä»¶
	æ–°å»ºredis6379.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹
		include /myredis/redis.conf
		pidfile /var/run/redis_6379.pid
		port <span class="token number">6379</span>
		dbfilename dump6379.rdb
	æ–°å»ºredis6380.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹
		include /myredis/redis.conf
		pidfile /var/run/redis_6380.pid
		port <span class="token number">6380</span>
		dbfilename dump6380.rdb		
	æ–°å»ºredis6381.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹
		include /myredis/redis.conf
		pidfile /var/run/redis_6381.pid
		port <span class="token number">6381</span>
		dbfilename dump6381.rdb	
		
slave-priority <span class="token number">10</span>
è®¾ç½®ä»æœºçš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œç”¨äºé€‰ä¸¾ä¸»æœºæ—¶ä½¿ç”¨ã€‚é»˜è®¤100
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>å¯åŠ¨</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-server redis6379.conf
redis-server redis6380.conf
redis-server redis6381.conf

<span class="token comment">#æŸ¥çœ‹</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> redis

<span class="token comment">#æ‰“å°ä¸»ä»å¤åˆ¶çš„ç›¸å…³ä¿¡æ¯</span>
info replication
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>é…ä»ä¸é…ä¸»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#æˆä¸ºæŸä¸ªå®ä¾‹çš„ä»æœåŠ¡å™¨
slaveof  &lt;ip&gt;&lt;port&gt;
1ã€åœ¨6380å’Œ6381ä¸Šæ‰§è¡Œ: slaveof 127.0.0.1 6379
2ã€åœ¨ä¸»æœºä¸Šå†™ï¼Œåœ¨ä»æœºä¸Šå¯ä»¥è¯»å–æ•°æ®
	åœ¨ä»æœºä¸Šå†™æ•°æ®æŠ¥é”™
3ã€ä¸»æœºæŒ‚æ‰ï¼Œé‡å¯å°±è¡Œï¼Œä¸€åˆ‡å¦‚åˆ
4ã€ä»æœºé‡å¯éœ€é‡è®¾ï¼šslaveof 127.0.0.1 6379
	å¯ä»¥å°†é…ç½®å¢åŠ åˆ°æ–‡ä»¶ä¸­ã€‚æ°¸ä¹…ç”Ÿæ•ˆã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>å¸¸ç”¨</strong>ï¼š</p> <ul><li><p>ä¸€ä¸»äºŒæ‰‘</p></li> <li><p>æ˜Ÿç«ç›¸ä¼ </p></li> <li><p>åå®¢ä¸ºä¸»ï¼šå½“masterå®•æœºåï¼Œåé¢çš„slaveå¯ä»¥ç«‹åˆ»å‡ä¸ºmasterï¼Œå…¶åé¢çš„slaveä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚</p> <blockquote><p>ç”¨ slaveof  no one  å°†ä»æœºå˜ä¸ºä¸»æœºã€‚</p></blockquote></li></ul> <p><strong>å¤åˆ¶åŸç†</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. Slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤
2. Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥
3. å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚
4. å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥
5. ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å“¨å…µæ¨¡å¼</strong>ï¼šåå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆ:èƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#éƒ¨ç½²
1. è°ƒæ•´ä¸ºä¸€ä¸»äºŒä»†æ¨¡å¼ï¼Œ6379å¸¦ç€6380ã€6381
2. è‡ªå®šä¹‰çš„/myredisç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œåå­—ç»ä¸èƒ½é”™
3. é…ç½®å“¨å…µ,å¡«å†™å†…å®¹
	sentinel monitor mymaster 127.0.0.1 6379 1
	å…¶ä¸­mymasterä¸ºç›‘æ§å¯¹è±¡èµ·çš„æœåŠ¡å™¨åç§°ï¼Œ 1 ä¸ºè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#å¯åŠ¨å“¨å…µ
/usr/local/bin
redisåšå‹æµ‹å¯ä»¥ç”¨è‡ªå¸¦çš„redis-benchmarkå·¥å…·
æ‰§è¡Œredis-sentinel  /myredis/sentinel.conf 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å…¶ä»–</strong>ï¼š</p> <ul><li><p>å¤åˆ¶å»¶æ—¶</p></li> <li><p>æ•…éšœæ¢å¤ ï¼šå…ˆé€‰æ‹©ä¼˜å…ˆçº§è€ƒå‰çš„ï¼Œé€‰æ‹©åç§»é‡åå¤§çš„ï¼Œrunidæœ€å°çš„ä»æœåŠ¡å™¨</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ä¼˜å…ˆçº§åœ¨redis.confä¸­é»˜è®¤ï¼šslave-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
åç§»é‡æ˜¯æŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„
æ¯ä¸ªrediså®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª40ä½çš„runid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>ä¸»ä»å¤åˆ¶</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">JedisSentinelPool</span> jedisSentinelPool<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token class-name">Jedis</span> <span class="token function">getJedisFromSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>jedisSentinelPool<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sentinelSet<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sentinelSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.11.103:26379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">JedisPoolConfig</span> jedisPoolConfig <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ€å¤§å¯ç”¨è¿æ¥æ•°</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ€å¤§é—²ç½®è¿æ¥æ•°</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ€å°é—²ç½®è¿æ¥æ•°</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setBlockWhenExhausted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è¿æ¥è€—å°½æ˜¯å¦ç­‰å¾…</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç­‰å¾…æ—¶é—´</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å–è¿æ¥çš„æ—¶å€™è¿›è¡Œä¸€ä¸‹æµ‹è¯• ping pong</span>

jedisSentinelPool<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisSentinelPool</span><span class="token punctuation">(</span><span class="token string">&quot;mymaster&quot;</span><span class="token punctuation">,</span>sentinelSet<span class="token punctuation">,</span>jedisPoolConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> jedisSentinelPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
<span class="token keyword">return</span> jedisSentinelPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ul> <h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="header-anchor">#</a> é›†ç¾¤</h2> <ul><li><p>é…ç½®åŸºæœ¬ä¿¡æ¯</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¼€å¯daemonize yes
Pidæ–‡ä»¶åå­—
æŒ‡å®šç«¯å£
Logæ–‡ä»¶åå­—
Dump.rdbåå­—
Appendonly å…³æ‰æˆ–è€…æ¢åå­—
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>redis clusteré…ç½®ä¿®æ”¹</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>cluster-enabled <span class="token function">yes</span>    æ‰“å¼€é›†ç¾¤æ¨¡å¼
cluster-config-file nodes-6379.conf  è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å
cluster-node-timeout <span class="token number">15000</span>   è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚


include /home/bigdata/redis.conf
port <span class="token number">6379</span>
pidfile <span class="token string">&quot;/var/run/redis_6379.pid&quot;</span>
dbfilename <span class="token string">&quot;dump6379.rdb&quot;</span>
<span class="token function">dir</span> <span class="token string">&quot;/home/bigdata/redis_cluster&quot;</span>
logfile <span class="token string">&quot;/home/bigdata/redis_cluster/redis_err_6379.log&quot;</span>
cluster-enabled <span class="token function">yes</span>
cluster-config-file nodes-6379.conf
cluster-node-timeout <span class="token number">15000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>ä¿®æ”¹å¥½redis6379.confæ–‡ä»¶,æ‹·è´å¤šä¸ªredis.confæ–‡ä»¶.</p></li> <li><p>ä½¿ç”¨æŸ¥æ‰¾æ›¿æ¢ä¿®æ”¹å¦å¤–5ä¸ªæ–‡ä»¶  ä¾‹å¦‚ï¼š:%s/6379/6380</p></li> <li><p>å¯åŠ¨6ä¸ªæœåŠ¡,å°†å…¶åˆå¹¶æˆä¸€ä¸ªé›†ç¾¤ã€‚ç»„åˆä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€æœ‰rediså®ä¾‹å¯åŠ¨åï¼Œnodes-xxxx.confæ–‡ä»¶éƒ½ç”Ÿæˆæ­£å¸¸ã€‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>åˆä½“ï¼š
	<span class="token builtin class-name">cd</span>  /opt/redis-6.2.1/src
	
	redis-cli --cluster create --cluster-replicas <span class="token number">1</span> <span class="token number">192.168</span>.11.101:6379 <span class="token number">192.168</span>.11.101:6380 <span class="token number">192.168</span>.11.101:6381 <span class="token number">192.168</span>.11.101:6389 <span class="token number">192.168</span>.11.101:6390 <span class="token number">192.168</span>.11.101:6391

<span class="token comment">#æ­¤å¤„ä¸è¦ç”¨127.0.0.1ï¼Œ è¯·ç”¨çœŸå®IPåœ°å€</span>
--replicas <span class="token number">1</span> é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼Œä¸€å°ä¸»æœºï¼Œä¸€å°ä»æœºï¼Œæ­£å¥½ä¸‰ç»„ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>å®¢æˆ·ç«¯ç™»å½•</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#æ™®é€šæ–¹å¼ç™»å½•</span>
redis-cli -p <span class="token number">6379</span>
<span class="token comment">#-c é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥ï¼Œè®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº</span>
redis-cli -c -p <span class="token number">6379</span>
<span class="token comment">#é€šè¿‡ cluster nodes å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</span>
CLUSTER GETKEYSINSLOT <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span>count<span class="token operator">&gt;</span> è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>jediså¼€å‘</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisClusterTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
     <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span>set <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.31.211&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">JedisCluster</span> jedisCluster<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisCluster</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
     jedisCluster<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedisCluster<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <p><strong>æ€»ç»“</strong>:</p> <ul><li>å¥½å¤„ï¼šå®ç°æ‰©å®¹ï¼Œåˆ†æ‘Šå‹åŠ›ï¼Œæ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å•ã€‚</li> <li>ä¸è¶³ï¼šå¤šé”®æ“ä½œä¸æ”¯æŒï¼Œä¸æ”¯æŒluaè„šæœ¬ï¼Œå¤šé”®äº‹åŠ¡ä¸è¢«æ”¯æŒã€‚</li></ul> <h2 id="åº”ç”¨é—®é¢˜"><a href="#åº”ç”¨é—®é¢˜" class="header-anchor">#</a> åº”ç”¨é—®é¢˜</h2> <h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="header-anchor">#</a> ç¼“å­˜ç©¿é€</h3> <ul><li><p>æè¿°ï¼škeyå¯¹åº”çš„æ•°æ®çš„æ•°æ®æºå¹¶ä¸å­˜åœ¨ï¼Œé’ˆå¯¹keyè¯·æ±‚ä»ç¼“å­˜ä¸­è·å–ä¸åˆ°ï¼Œè¯·æ±‚ä¼šå­˜å‚¨åˆ°æ•°æ®æºï¼Œæ•°æ®æºå¯èƒ½ä¼šè¢«å‹å®ã€‚</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030163050.png" alt=""></p></li> <li><p>è§£å†³åŠæ³•</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ï¼ˆ1ï¼‰å¯¹ç©ºå€¼ç¼“å­˜ï¼šå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®æ˜¯å¦ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“å­˜ï¼Œ
	è®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿ
ï¼ˆ2ï¼‰è®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼šä½¿ç”¨bitmapsç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå•idä½œä¸ºbitmapsçš„åç§»é‡ï¼Œ
	æ¯æ¬¡è®¿é—®å’Œbitmapé‡Œé¢çš„idè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè®¿é—®idä¸åœ¨bitmapsé‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚
ï¼ˆ3ï¼‰é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼š<span class="token punctuation">(</span>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚
	å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡<span class="token punctuation">(</span>ä½å›¾<span class="token punctuation">)</span>å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚
	å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œ
	ç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚<span class="token punctuation">)</span>
	å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„bitmapsä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢« è¿™ä¸ªbitmapsæ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚
ï¼ˆ4ï¼‰è¿›è¡Œå®æ—¶ç›‘æ§ï¼šå½“å‘ç°Redisçš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®é»‘åå•é™åˆ¶æœåŠ¡ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul> <h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="header-anchor">#</a> ç¼“å­˜å‡»ç©¿</h3> <ul><li><p>æè¿°ï¼škeyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030163814.png" alt=""></p></li> <li><p>è§£å†³åŠæ³•</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ï¼ˆ1ï¼‰é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼šåœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ°redisé‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ®keyçš„æ—¶é•¿
ï¼ˆ2ï¼‰å®æ—¶è°ƒæ•´ï¼šç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´keyçš„è¿‡æœŸæ—¶é•¿
ï¼ˆ3ï¼‰ä½¿ç”¨é”ï¼š
    ï¼ˆ1ï¼‰å°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbã€‚
    ï¼ˆ2ï¼‰å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚Redisçš„SETNXï¼‰å»setä¸€ä¸ªmutex key
ï¼ˆ3ï¼‰å½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œï¼Œå¹¶å›è®¾ç¼“å­˜,æœ€ååˆ é™¤mutex keyï¼›
	å½“æ“ä½œè¿”å›å¤±è´¥ï¼Œè¯æ˜æœ‰çº¿ç¨‹åœ¨load dbï¼Œå½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´å†é‡è¯•æ•´ä¸ªgetç¼“å­˜çš„æ–¹æ³•ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="header-anchor">#</a> ç¼“å­˜é›ªå´©</h3> <ul><li><p>æè¿°ï¼škeyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚ç¼“å­˜é›ªå´©ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹å¾ˆå¤škeyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯æŸä¸€ä¸ªkeyæ­£å¸¸è®¿é—®</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030164117.png" alt=""></p></li></ul> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211030164412.png" alt=""></p> <ul><li><p>è§£å†³åŠæ³•</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ï¼ˆ1ï¼‰æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼šnginxç¼“å­˜ + redisç¼“å­˜ +å…¶ä»–ç¼“å­˜ï¼ˆehcacheç­‰ï¼‰
ï¼ˆ2ï¼‰ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ï¼š
ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µ
ï¼ˆ3ï¼‰è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ï¼š
è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚
ï¼ˆ4ï¼‰å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼š
æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="header-anchor">#</a> åˆ†å¸ƒå¼é”</h3> <ul><li><p>æè¿°ï¼šåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„Java APIå¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚</p></li> <li><p>è§£å†³åŠæ³•ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š
    <span class="token number">1</span>. åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”
    <span class="token number">2</span>. åŸºäºç¼“å­˜ï¼ˆRedisç­‰ï¼‰
    <span class="token number">3</span>. åŸºäºZookeeper
    æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š
    <span class="token number">1</span>. æ€§èƒ½ï¼šredisæœ€é«˜
    <span class="token number">2</span>. å¯é æ€§ï¼šzookeeperæœ€é«˜
    è¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäºrediså®ç°åˆ†å¸ƒå¼é”ã€‚
ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”ï¼š
	redis:å‘½ä»¤
	<span class="token comment"># set sku:1:info â€œOKâ€ NX PX 10000</span>
	EX second ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value ã€‚
	PX millisecond ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value ã€‚
	NX ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value ã€‚
	XX ï¼šåªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚
	
	<span class="token number">1</span>. å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è·å–é”ï¼ˆsetnxï¼‰
	<span class="token number">2</span>. è·å–æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘<span class="token punctuation">{</span>ä»dbè·å–æ•°æ®ï¼Œæ”¾å…¥ç¼“å­˜<span class="token punctuation">}</span>ï¼Œæ‰§è¡Œå®Œæˆé‡Šæ”¾é”ï¼ˆdelï¼‰
	<span class="token number">3</span>. å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…é‡è¯•
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p>ä»£ç å®ç°</p> <ol><li>åŠ é”</li> <li>ä½¿ç”¨luaé‡Šæ”¾é”</li> <li>é‡è¯•</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š
- äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚
- ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚
- è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚
- åŠ é”å’Œè§£é”å¿…é¡»å…·æœ‰åŸå­æ€§ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2021/10/30 ä¸‹åˆ5:58:37</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="/assets/js/app.7036e47e.js" defer></script><script src="/assets/js/4.ec8df83f.js" defer></script><script src="/assets/js/1.d2920358.js" defer></script><script src="/assets/js/2.245be42e.js" defer></script><script src="/assets/js/56.248288b0.js" defer></script><script src="/assets/js/12.44af248e.js" defer></script>
  </body>
</html>
