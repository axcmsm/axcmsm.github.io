(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{647:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"spark环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spark环境搭建"}},[s._v("#")]),s._v(" spark环境搭建")]),s._v(" "),t("h2",{attrs:{id:"本地模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地模式"}},[s._v("#")]),s._v(" 本地模式")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 上传解压安装包 改名\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf /opt/sortware/hadoop3/spark-3.0.0-bin-hadoop3.2.tgz -C /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /opt/module/spark-3.0.0-bin-hadoop3.2/ /opt/module/spark\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 直接启动\n/opt/module/spark/bin/spark-shell\n\nUI 访问端口 http://虚拟机地址:4040\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"yarn模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yarn模式"}},[s._v("#")]),s._v(" yarn模式")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 上传解压安装包 改名\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf /opt/sortware/hadoop3/spark-3.0.0-bin-hadoop3.2.tgz -C /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /opt/module/spark-3.0.0-bin-hadoop3.2/ /opt/module/spark\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".修改hadoop中的yarn-site.xml配置文件 记得分发\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/hadoop/etc/hadoop/yarn-site.xml\n\t\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#xsync /opt/module/hadoop/etc/hadoop/yarn-site.xml  #分发")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".修改spark中的spark-env.sh  添加java环境变量 添加yarn的环境变量\n\t "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /opt/module/spark/conf/spark-env.sh.template /opt/module/spark/conf/spark-env.sh\n\t "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/spark/conf/spark-env.sh \n\t \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". 启动hdfs 和yarn  创建日志存放目录\n\tstart-dfs.sh\n\tstart-yarn.sh\n\tmr-jobhistory-daemon.sh start historyserver\n\t\n\t\n\thadoop fs -mkdir /yarn-spark-log\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". 配置历史服务器 （如果是hdf是ha的话要指定对应 集群名称 否则找不到具体的namenode）\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /opt/module/spark/conf/spark-defaults.conf.template /opt/module/spark/conf/spark-defaults.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/spark/conf/spark-defaults.conf\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". 修改日志级别\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /opt/module/spark/conf/log4j.properties.template /opt/module/spark/conf/log4j.properties\nvim/opt/module/spark/conf/log4j.properties\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改")]),s._v("\nlog4j.rootCategory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ERROR, console\n\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(". 启动启动历史服务 \n\t/opt/module/spark/sbin/start-history-server.sh\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(". 验证 or 提交程序 （3选1）\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". spark-shell --master "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". spark-shell --master "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" --deploy-mode client\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". \nbin/spark-submit "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--class org.apache.spark.examples.SparkPi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--master "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--deploy-mode cluster "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n./examples/jars/spark-examples_2.12-3.0.0.jar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("yarn-site.xml")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--是否启动一个线程检查每个任务正使用的物理内存量，如果任务超出分配值，则直接将其杀掉，默认是 true --\x3e")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \t\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("yarn.nodemanager.pmem-check-enabled"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t\t "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("false"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--是否启动一个线程检查每个任务正使用的虚拟内存量，如果任务超出分配值，则直接将其杀掉，默认是 true --\x3e")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t\t "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("yarn.nodemanager.vmem-check-enabled"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \t\t\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("false"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("spark-env.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/jdk1.8.0_212\n\t"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("YARN_CONF_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/hadoop/etc/hadoop\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_HISTORY_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n-Dspark.history.ui.port=18080 \n-Dspark.history.fs.logDirectory=hdfs://master:8020/directory \n-Dspark.history.retainedApplications=30"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("spark-defaults")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("spark.eventLog.enabled "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nspark.eventLog.dir hdfs://master:8020/directory "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#目录需要提前创建")]),s._v("\nspark.yarn.historyServer.address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("master:18080\nspark.history.ui.port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18080")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"ha模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ha模式"}},[s._v("#")]),s._v(" HA模式")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 停止集群\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 启动zk集群\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 修改 spark-env.sh 文件\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SPARK_MASTER_HOST=master")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SPARK_MASTER_PORT=7077")]),s._v("\n\t添加如下内容:\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Master 监控页面默认访问端口为 8080，但是可能会和 Zookeeper 冲突，")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所以改成 8989，也可以自定义，访问 UI 监控页面时请注意")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_WEBUI_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8989")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_DAEMON_JAVA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n\t-Dspark.deploy.recoveryMode=ZOOKEEPER \n\t-Dspark.deploy.zookeeper.url=master,slave1,slave2\n\t-Dspark.deploy.zookeeper.dir=/spark"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". 分发配置文件\n\txsync conf/\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". 启动集群\n\tsbin/start-all.sh\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(". 启动备用master "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("部署master的机器上"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tsbin/start-master.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h2",{attrs:{id:"集群模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群模式"}},[s._v("#")]),s._v(" 集群模式")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 解压文件到指定目录\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 修改节点配置文件\n\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" conf\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" slaves.template slaves  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将模板文件修改成自己的")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加修改主机节点")]),s._v("\n    master\n    slave1\n    slave2\n    \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 修改执行配置文件\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" spark-env.sh.template spark-env.sh "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将模板文件改名")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加 JAVA_HOME 环境变量和集群对应的 master 节点")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/jdk1.8.0_144\n\t"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hadoop111\n\t"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_MASTER_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7077")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内部通信端口类似8020")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". 分发修改好的压缩目录\t\n\txsync spark-standalone\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". 启动or关闭\n\t/opt/module/spark/sbin/start-all.sh  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动")]),s._v("\nUI访问端口：Web UI 界面: http://master:8080\t\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(". 配置历史服务\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" spark-defaults.conf.template spark-defaults.conf \n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置日志存储路径")]),s._v("\n\tspark.eventLog.enabled "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启")]),s._v("\n\tspark.eventLog.dir hdfs://master:8020/directory "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此目录需要在hdfs上提前创建")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改 spark-env.sh 文件, 添加日志配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_HISTORY_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n\t-Dspark.history.ui.port=18080 #日志的WEB UI访问端口\n\t-Dspark.history.fs.logDirectory=hdfs://master:8020/directory #存储路径\n\t-Dspark.history.retainedApplications=30"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保存的历史个数")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分发配置文件")]),s._v("\n\txsync conf\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启集群和历史服务")]),s._v("\n\tsbin/start-all.sh\n\tsbin/start-history-server.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);